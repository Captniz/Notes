{"path":"SISTEMI/TeoriaQuinta/stp_vlan.pdf","text":"UNITÀ 2 FIGURA 1 LAN segmentata con un router in 4 segmenti 34 \u0014 EFFICIENZA E SICUREZZA NELLE RETI LOCALI E]STP: L PROTOCOLLO DI COMUNICAZIONE TRA GLI SWITCH 1.1 Reti locali \u001csegmentate\u001d Le moderne reti locali sono \u001csegmentate\u001d, cioè suddivise in parti più piccole, dette segmenti, tramite switch (o bridge, ma nel seguito parleremo solo di switch) a] fine di isolare il traffico tra i segmenti e raggiungere una maggiore ampiezza di banda per Ogni computer grazie alla creazione di domini di collisione più piccoli Il dominio di collisione di una rete è un'area in cui può verificarsi una collisione, Per esempio, se abbiamo 5 computer connessi allo stesso mezzo condiviso, i dati inviati da uno di essi possono collidere con i dati inviati da un altro. In questo caso abbiamo un dominio di collisione che contiene 5 host. Oltre alle LAN segmentate con switch, è possibile creare segmenti di LAN utiliz- zando i router (FiGURA 1). Questa soluzione rende più lenta la trasmissione rispetto alla soluzione con gli switch (a meno di usare router che implementino funzionalità di switching). segmento 1 segmento 2 / router hub segmento 3 segmento 4 STP: IL PROTOCOLLO DI COMUNICAZIONE TRA GLI SWITCH Infatti il router è un apparato che opera a livello Network, basa le sue decisioni sugli indiriz?i di rete (IP address) e non su quelli fisici (MAC address) e implementa al- goritmi per tfovare il percorso migliore che richiedono più tempo di elaborazione. Spesso le reti con switch sono Progettate con percorsi fisici ridondanti al fine di evitare che il guasto di un cavo o di una porta di un apparato possa portare al blocco delle trasmissioni sulla rete. Se da un lato la duplicazione dei percorsi offre maggiori garanzie in termini di affi- dabilità e fault tolerance, dall\u0019altro può dar luogo a effetti indesiderati (side effects), come la creazione di loop che portano al fenomeno detto \u001cbroadcast storm\u001d che può in breve tempo bloccare la rete, Un broadcast storm (letteralmente \u001ctempesta di broadcast\u001d) avviene quando ci so- no così tanti franie broadeast in un loop da impegnare tutta la banda disponibile. Un broadcast storin è inevitabile su lina rete con percorsi ridondanti (FIGURA 2). switch A broadcast switch B switch C Per evitare questi loop gli switch usano un protocollo per la gestione dei collegamen- ti, denominato #STP (Spanning Tree Protocol). 1.2 Spanning Tree Protocol STP è un protocollo definito nello standard IEEE 802.1 per realizzare reti LAN com- plesse senza loop. Con STP si crea un albero gerarchico che mantiene ancora dispo- nibili i percorsi alternativi da usare in caso di necessita, quindi si lasciano loop fisici ma si eliminano a livello di topologia logica. Infatti, una volta rilevato che esistono più percorsi tra i nodi della rete (loop), il pro- tocollo STP crea una struttura ad albero relegando i percorsi ridondanti a uno stato di standby (blocked) della relativa porta dello switch. STP permette che venga stabilito un solo percorso attivo alla volta tra due disposi- tivi della rete per evitare i loop, tuttavia stabilisce collegamenti ridondanti come al- ternative nel caso in cui il collegamento primario dovesse non essere più disponibile. Se in un certo istante un segmento della rete dovesse diventare irraggiungibi- le, I'algoritmo di Spanning Tree riconfigurera la topologia logica, ristabilendo il LEZIONE 1 FIGURA 2 Loop con broadcast storm STP (Spanning Tree Protocol) è cosi denominato in quanto il risultato dell'eliminazione dei loop è quello di creare un al- bero logico gerarchico. 35 UNITÀ 2 FIGURA 3 Esempio di LAN con STP 36 \u0014 collegamento attraverso l'attivazione del percorso in standby (cioè attivang, porta prima inattiva). . Se non ci fosse la struttura di Spanning Tree, entrambi i collegamenti ridondanti trebbero essere considerati il percorso primario, producendo così un loop infinito 4 traffico sulla LAN. l Nella FiGURA 3 si mostra un esempio di rete locale con 3 switch interconnessi A,Bec EFFICIENZA E SICUREZZA NELLE RETI LOCALI Link attivi Link inattivi (blocked) In assenza di STP, tra questi switch si avrebbe un loop, ma se STP è attivo, il link L3 (rosso) è messo in stato blocked, così non può essere usato per la trasmissione dati. Se si verificasse un guasto sui link L1 oppure su L2, il link L3 verrebbe attivato auto- maticamente. Questa soluzione fornisce quindi una condizione di ridondanza per la rete, senza incorrere nel problema dei loop. Anche gli switch D, E, F e G forniscono una ridondanza sui link (per via dei collegamenti segnati in rosso) e se STP & attivo, vale quanto indicato prima per gli switch A, Be C. Annotiamo che, per tradizione, il termine \u001cbridge\u001d continua a essere usato anche quando STP si applica a una rete con switch, poiché STP fu sviluppato per essere uti- lizzato con i bridge. Quindi quando si legge \u001cbridge\u001d (per esempio, root bridge) si de- ve pensare \u001cswitch\u001d (root switch). Ogni switch della LAN invia dei messaggi detti BPDU (Bridge Protocol Data Unit) trasmessi da tutte le porte per conoscere I'esistenza di altri switch e per eleggere U\" root bridge nella rete (cioè la radice dell'albero logico che si verra a creare). 1 BPDU contengono informazioni per: * selezionare un solo switch come root dello Spanning Tree; calcolare il percorso più breve da ogni switch alla root; STP: IL PROTOCOLLO DI COMUNICAZIONE TRA GLI SWITCH o eleggere il designated switch, che per ogni LAN è lo switch più vicino alla root, attraverso cui passano tutte le comunicazioni della LAN; e scegliere per ogni switch la root port, cioè l'\u0019interfaccia che dà il miglior percor- so verso la root. Le porte che fanno parte dello Spanning Tree sono le designated port, le altre so- no bloccate. Quando si attiva l'algoritmo per la creazione dello Spanning Tree, trascorre un certo tempo, da 30 a 50 secondi, prima che la topologia logica della rete converga, ossia che tutte le porte degli switch siano nello stato blocked o forwarding. Quando la topolo- gia cambia, gli switch ricalcolano lo Spanning Tree. Quando la LAN ha ottenuto la convergenza e si è creato l'albero gerarchico (FIGURA 4), si hanno i seguenti elementi: e un root bridge per LAN; e una root port per i non root bridge; e una dcsngnalcd port per segmento; e porte non usate. root bridge tutte le porte designated (forwarding) designated designated (forwarding) (forwarding) root port root port designated non designated (forwarding) (blockis ;É Ogni porta dello switch in STP si può quindi trovare in uno dei seguenti stati: * blocking: può solo ricevere le BPDU, scarta i frame e non è in grado di apprende- re nessun indirizzo fisico; * listening: sta costruendo la topologia \u001cattiva\u001d della rete, ossia lo switch determina se ci sono altri percorsi verso il root bridge; * learning: sta costruendo la tabella di bridging, quindi è in grado di apprendere gli indirizzi fisici, ma non invia né riceve dati; * forwarding: può inviare e ricevere dati e in generale è in grado di svolgere tutte le funzioni possibili; disabled: è stata disabilitata (cioé resa down) dall'amministratore. LEZIONE 1 FIGURA 4 Esempio di gerarchia creata con STP 37 rà 2 Ehwords __ tnerale, il tempo di con- lenza della rete & il tem- he la rete stessa impiega |?giornlrn i percorsi in lito a una modifica (per npio, il guasto o l'aggiun- i un nodo, l'attivazione tlgoritmo Spanning Tree). EFFICIENZA E SICUREZZA NELLE RETI LOCALI Nelle reti attuali un #tempo di convergenza di 30 -50 secom?ll risulta inag al velocità elevate delle LAN, di conseguenza molti pmdn\u0019tton.hanno sviluppato ddk modifiche, proprietarie, al protocollo STP standard al fine di ottenere temp; q; i vergenza inferiori. _ _ Un'altra modifica & quella di permettere all'amministratore di configurare ma, j mente le porte alle quali è connesso un computer (¢ non un altro switch), così da o tare che la porta transiti attraverso tutti gli stati previsti dal protocollo, ma Passi dj. rettamente da blocked/disabled a forwarding. Tutte queste migliorie hanno consentito di abbassare il tempo di convergenza, nonostante cid, sui link a elevata velocita che necessitano di ridondanza, gli switch & livello 2 sono sostituiti da apparati di livello superiore, chiamati MultiLayer Switch, 1.3 Evoluzione del protocollo Spanning Tree: RSTp Negli anni STP ha subito varie evoluzioni: sul sito di IEEE (www.ieee.org) è possibile avere informazioni sugli sviluppi in corso che riguardano STP. Nel 2001 IEEE defini il nuovo protocollo Rapid Spanning Tree Protocol (RSTP), identificato dalla sigla IEEE 802.1w, allo scopo di rendere più veloce la convergenza dell\u0019algoritmo Spanning Tree a fronte di cambiamenti della topologia. Infatti, RSTP & in grado di intervenire entro: 3 - Hello time, dove Hello time & un in- tervallo di tempo usato da RSTP in vari ambiti; il suo valore di default è 2 secondi. Nel 2004 è stata emessa una nuova specifica dello standard, denominata IEEE Std 802.1D\"-2004, che include il nuovo protocollo RSTP e rende obsoleto STP. Pur mantenendo la struttura di STP, con un root bridge da cui parte lo Spanning Tree e un path costituito dagli switch, RSTP calcola un percorso alternativo definendo le porte che lo costituiscono alternate; eventuali porte da cui partono altri percorsi con costo maggiore rimangono in stato blocking. Quando una porta in forwarding smette di ricevere i frame di Hello e i timer scadono, viene subito attivato un altro percorso aprendo le porte alternate, velocizzando notevolmente il processo di convergenza. Quando uno switch ha due porte in un stesso segmento, quella a costo più alto vie- ne definita in un nuovo modo: backup. Quando la porta in forwarding non funzio- na più, quella in backup prende il suo posto. Anche in questo caso la convergenza è molto veloce. Da sottolineare che RSTP non migliora la convergenza nei link condivisi, infatti lo standard @ stato sviluppato pensando alle reti moderne che non usano più hub ma switch e che lavorano in full-duplex. Che cosa significa \u001csegmentare\u001d una rete locale? Che cosa si intende con dominio di collisione? = Che differenza c'è tra una LAN segmentata usando uno switch e una segmen- tata usando un router? = Quali problemi può creare I'operazione di rendere ridondante la rete? Spiega il protocollo Spanning Tree Protocol. = Quali sono gli stati in cui si può trovare una porta di uno switch in cui è atti- vo STP? e LE RETI LOCALI VIRTUALI (VLAN) A LE RETI LOCALI VIRTUALI (VLAN) 2.1 Dominio di broadcast Nella Lezione precedente si è visto come I'impiego di switch in una LAN consen- ta di segmentare la rete in domini di collisione separati. Oltre a ciò, è utile avere anche domini di broadcast separati, in modo da poter implementare tra i diversi segmenti di rete funzioni tipiche del livello Network, come la sicurezza o la qua- lità del servizio. [l dominio di broadcast di una rete è un insieme di computer che riceve un messag- gio di broadcast trasmesso da uno di essi. La TABELLA +1 mostra come l'impiego di apparati di rete diversi (hub, switch o router) comporti un diverso rapporto con i domini di collisione e di broadcast. hub uno per tutte le porte | uno per tutte le porte switch | uno per ogni porta uno per tutte le porte router | uno per ogni porta uno per ogni porta La tipica configurazione di uno switch prevede quindi che tutti gli host collegati a esso siano parte dello stesso dominio di broadcast, mentre vi possono essere molti domini di collisione. Infatti una coppia di host che comunica tramite lo switch for- ma un singolo dominio di collisione, di conseguenza con gli switch non si eliminano del tutto le collisioni (se due host vogliono inviare l'uno all'altro un messaggio esat- tamente nel medesimo istante, si avrà ancora una collisione). Se quindi le collisioni non sono più un problema nelle reti che usano switch, il fatto che questi inoltrino su tutte le porte un messaggio di broadcast può generare molto traffico su reti con centinaia di host. Per ovviare a questo problema, gli switch attuali offrono due diverse tecnologie: 1. Virtual LAN (VLAN): si creano delle sottoreti nella rete locale che, in realtà, esi- stono solo sugli switch. La rete rimane configurata con la stessa topologia fisica, mentre cambia la topologia logica; quando un computer su una data sottorete in- via un messaggio broadcast, esso verra trasmesso solo ai computer appartenenti a quella sottorete e non a tutta la rete locale; 2. Layer 3 switching: quando un host su una VLAN deve comunicare con un host su un'altra VLAN, è necessaria la presenza di un router che interconnette le due VLAN, dopo di che intervengono i rispettivi switch (questo processo viene an- che detto: route once, switch many). Se invece si usano switch con funzionalita di routing, detti switch Layer-3 (il riferimento è al livello 3 del modello OSI chesi occupa dell'instradamento dei pacchetti), non & più necessario avere un router, in quanto questi switch sono in grado di leggere I'indirizzo di rete contenuto nel pacchetto e individuare verso quale switch inviare i pacchetti. In questo modo viene minimizzata 'attivita di routing tra VLAN, effettuandola solo quando è as- solutamente necessario. TABELLA 1 Descrizione dei domini per tipo di apparato UNITÀ 2 Quando si configura una VLAN, la topologia logica è indipendente da quella fisica. FIGURA 5 Esempio di realizzazione di 2 VLAN per gruppi di porte progettazione \u0018 EFFICIENZA E SICUREZZA NELLE RETI LOCALI 2.2 Vantaggi e svantaggi delle VLAN La segmentazione e I'isolamento del traffico che si realizzano con le VL AN i tono di ridurre il traffico non necessario, migliorando notcvulmenge le preslaszîem rete. Questo importante vantaggio compensa la difficoltà nel configurare le VLAN\\ attività che richiede un notevole lavoro di pianificazione e realizzazione, ] Con le VLAN, infatti: * è semplice aggiungere, cambiare o spostare gli host sulla rete; © si definiscono più domini di broadcast, di dimensioni ridotte, all\u0019interno diun stessa rete locale switched, e questo implica un miglioramento delle Preshzu: ni della rete; * migliora la sicurezza della rete; * riduce i costi relativi agli apparati di rete impiegati. Le VLAN non sono da considerarsi una soluzione alternativa alle reti con router per realizzare la comunicazione tra reti differenti (internetworking). 2.3 Creazione di una VLAN Una Virtual Local Area Network (VLAN) è un insieme di computer, stampant;, server o altri device di rete che sono trattati come se fossero collegati a una singoly rete, mentre, in realta, si trovano su LAN fisiche diverse. La tecnica di realizzazione delle VLAN permette di raggruppare, per esempio, una g Più porte di uno switch in modo da considerarle parte di una stessa rete virtuale alla quale possono essere aggiunte porte di altri switch. A ogni host della LAN può essere assegnato un numero identificativo (VLAN ID) per identificare la VLAN di appartenenza (FIGURA s). Host con lo stesso VLAN ID s comportano come se si trovassero nella stessa rete fisica. VLAN ID = 2 Una VLAN può essere creata in più modi: \u0014\u0014\u0014\u0014\u0014\u0014\u0014 \\ * per gruppi di porte, a questo scopo si utilizza l'iden- ! tificativo della porta; è la modalità più comune ed è : tipica delle LAN che utilizzano un indirizzamento di- | namico a livello Network (per esempio tramite il pro- | tocollo DHCP, Dynamic Host Configuration Protocol, ! per l\u0019assegnazione degli indirizzi IP); : ® per utenti, tramite l\u0019indirizzo fisico (MAC) dellhost: | questa modalita è poco usata in quanto più difficile [ da gestire; : * per protocolli, la modalita è simile alla precedente, | ma invece di indirizzi fisici usa indirizzi logici (per | esempio I'indirizzo IP); da quando si è diffuso l'uso ) del DHCP per assegnare gli indirizzi IP non è più co- amministrazione munemente usata. Vediamo con un esempio cosa significa che le VLAN permettono di raggruppare a spositivi indipendentemente dalla loro locazione fisica. Supponiamo di dover suddividere una rete LAN in 3 aree distinte che corrispondon° a 3 diversi gruppi di utenti: gli amministrativi, i progettisti e i venditori. __ LE RETI LOCALI VIRTUALI (VLAN) La FiGURA 6 mostra due diverse soluzioni per realizzare la segmentazione di rete ri- chiesta da questo scenario: a) b) / amministrazione progettazione vendita a) la LAN è divisa in 3 segmenti di rete realizzati tramite l'impiego di 3 switch; b) la LAN è divisa in 3 segmenti di rete realizzati tramite la configurazione software di 3 VLAN. : Si noti che affinché un membro del personale di vendita della VLAN 3 possa condi- videre delle risorse con il dipartimento della progettazione della VLAN 2, è necessa- rio introdurre un router o scegliere uno switch Layer-3. Tra router e switch occorrono, perd, tante linee quante sono le VLAN definite, quin- di sul router deve essere configurata un'interfaccia per ogni VLAN. In questa mo- dalita, il traffico fluisce attraverso il router come se si usassero LAN fisiche e non virtuali. Dal momento che un router deve effettuare maggiori elaborazioni sui pac- chetti rispetto a uno switch, le prestazioni che offre questa realizzazione dipendono da quanto traffico rimane all'interno di una singola VLAN e quanto deve essere in- stradato verso altre VLAN. Inoltre, dedicare un'interfaccia per ogni VLAN realizzata richiede di riservare un certo numero di porte sia sullo switch che sul router; spesso perd i router di fascia bassa non hanno un elevato numero di porte Ethernet, quindi si dovrebbe scegliere un router più costoso. Un'alternativa a questa realizzazione & quella di usare un trunk. 2.4 VLAN Trunking Un metodo per permettere la comunicazione tra host collocati in VLAN diverse è di realizzare tra switch e router, oppure tra switch e switch, un canale comune, detto trunk, sul quale far transitare le comunicazioni tra VLAN diverse (FIGURA 7). Di norma per realizzare questo collegamento si sceglie la porta più veloce disponibi- le sull\u0019apparato di rete, in quanto sara usato per trasportare grossi volumi di traffico. LEZIONE 2 VLAN1T amministrazione VLAN 2 progettazione VLAN 3 vendita FIGURA 6 (a) Rete locale segmentata con 3 switch; (b) rete locale con uno switch e 3 VLAN Il concetto di trunk ha origine nella tecnologia radio, dove rappresenta una linea di co- municazione che trasporta piu canali con segnali radio. 41 UNITÀ 2 Access links FIGURA 7 Le VLAN si po}sono estendere tra vari switch utilizzando trunk che convogliano traffico di VLAN diverse FIGURA 8 Rappresentazione di un trunk usato per mettere in comunicazione 3 diverse VLAN Affinché uno switch poassa inoltrare il messaggio al desti- natario tramite un trunk, esso EFFICIENZA E SICUREZZA NELLE RETI LOCALI Trunk link Nella Figura 7 vengono evidenziati i due tipi di collegamento presenti nelle re- ti VLAN: * access link: si tratta di un collegamento che fa parte di una sola VLAN; un computer collegato tramite questo tipo di link diventa parte di un dominio di broadcast e pud comunicare solo con gli altri computer di questo dominio, a meno che il pacchetto da trasmettere sia inoltrato verso un router; il computer non è consapevole di appartenere a una VLAN, in quanto lo switch rimuove ogni informazione a essa relativa prima di inviargli il pacchetto; trunk link: & un collegamento punto-punto sul quale transita il traffico appar- tenente a VLAN diverse (fino a 4096); può essere usato tra due switch, tra uno switch e un server o anche tra uno switch e un router. La FIGURA 8 visualizza un trunk attraverso il quale transitano le comunicazioni rela- tive a 3 diverse VLAN. PC-D PC-G 11 frame Ethernet non prevede un campo per effettuare il tagging delle VLAN (le VLAN sono state inventate successivamente), esistono quindi vari metodi per ass0\u001d ciare un tag ai messaggi (frame) inviati sul trunk; per esempio, Cisco ha definito, Pf' alcuni suoi switch, il protocollo Inter-Switch Link (ISL) e 3COM il protocollo Vir: tual LAN Trunk (VLT). Attualmente, perd, si tende ad abbandonare i protocolli proprietari, preferendo a qu°\u0019 sti degli standard internazionali. Lo standard definito a livello internazionale, quindi protocollo non proprietario: 1EEE 802.1q. & B LE RETI LOCALI VIRTUALI (VLAN) @ EEE 802.1Q Questo standard prevede di inserire un campo di 4 byte per la gestione del tag (FIGURA 9), suddiviso come di seguito indicato. . Tag Protocol ID (TPID), 2 byte, usato per identificare il frame come un frame |EEE 802.1q (il valore & 0x8100). e Tag Control Information (TCI), 2 byte, cosi suddiviso: - User Priority, 3 bit, indica il livello di priorita del frame; va da 1, bassa priorita, a 7, alta priorita. Lo zero indica nessuna priorita (best effort). - Canonical Format Indicator (CFI), 1 bit, usato in passato per indicare se gli indirizzi nel frame erano in forma canonica, ora è chiamato Drop Eligible Indicator (DEI) ¢, usato insieme a User Priority, segnala i frame da scartare (drop) in caso di congestione in rete; - VLAN ID, 12 bit, indica a quale VLAN appartiene il frame (ID = 0 e ID = 4096 sono riservati). 4 byte H 802.1q VLAN Tag @ VLAN TRUNKING PROTOCOL (VTP) In reti complesse, la gestione delle VLAN richiede molto tempo e si possòno com- mettere facilmente errori. Una soluzione a questo problema & I'utilizzo del protocollo VTP (VLAN Trunking Protocol), proprietario Cisco, che permette di gestire central- mente su uno switch i nomi e i membri di una VLAN e poi distribuire in automatico la configurazione sugli altri switch. Dal punto di vista del protocollo VTP, gli switch si suddividono in: e VTP server: switch sui quali si effettuano le modifiche di configurazione delle VLAN; * VTP client: switch ai quali sono propagati i cambiamenti effettuati sui VTP server; * VTP transparent: switch che ricevono e inoltrano gli aggiornamenti, ma non li applicano alla propria configurazione; eventuali modifiche su questi switch do- vranno essere fatte manualmente. Nella Lezione 7 vedremo come realizzare delle VLAN con trunk e come STP risolva iloop mediante un'esercitazione con Cisco Packet Tracer. FIGURA 9 Frame Ethernet modificato con l'inserimento del campo per il tagging delle VLAN | Fissa e conoscenze [ (] +r ® Che cos'è una VLAN? ® In quale standard si trovano le specifiche per le VLAN? ® In che modo è possibile comunicare tra VLAN? m Spiega l'uso di trunk con le VLAN. una rete con 3 VLAN","libVersion":"0.2.3","langs":""}