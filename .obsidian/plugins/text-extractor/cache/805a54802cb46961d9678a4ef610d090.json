{"path":"SISTEMI/TeoriaQuinta/DNS.pdf","text":"IL DNS (DOMAIN NAME SYSTEM) 3 L DNS (DOMAIN NAME SYSTEM) 6.1 La risoluzione dei nomi Lapplicazione DNS (Domain Name System) consente agli utenti della rete di usare dei nomi per identificare un computer con funzioni di server al posto del suo indirizzo IP. Le specifiche del DNS si trovano negli RFC 1034 e RFC 1035 e successivi aggiorna- menti. Questo sistema è basato su un database distribuito, organizzato gerarchica- mente e che segue il modello Client/Server. 11 DNS è formato da 3 componenti principali. * Domain Name Space, specifica la struttura ad albero dei nomi di dominio. 11 Name Space risulta diviso in 3 tipi di domini: 1. domini radice: sono i domini di primo livello (Top Level Domain, TLD); 2. domini intermedi: sono domini che hanno a loro volta dei sottodomini; 3. domini foglia: sono domini privi di sottodomini e contengono solo host. e Name Server, è un processo applicativo con il ruolo di server che contiene infor- mazioni su alcune parti del Name Space chiamate zone. [l Name Server costitui- sce una authority per tali zone (viene detto authoritative Name Server). Un Name Server contiene anche i puntatori ad altri Name Server che possono essere usa- ti per ricavare informazioni su altre zone. La zona dei TLD è detta root zone e i Name Server che ne rispondono sono i root Name Server. Questi conoscono anche gli indirizzi degli authoritative Name Server per ciascun dominio TLD. * Resolver, è un programma con il ruolo di client che ottiene informazioni dal Name Ser- ver. Tipicamente viene realizzato da procedure del Sistema Operativo. Per esempio in Unix per accedere al resolver si richiamano le routine gethostbyname e gethostbyaddr. 1l sistema DNS è usato anche all'interno delle reti locali private per risolvere i nomi dei computer (hostname). Infatti, grazie al DNS, si possono associare alle macchi- ne dei nomi facili da ricordare; i nomi possono rimanere gli stessi anche se cambia I'indirizzo IP; gli utenti possono connettersi ai server locali usando le stesse con- venzioni usate su Internet (URL). Per comporre il nome completo di un dominio si percorre il cammino dalla foglia (che rappresenta I'host) alla radice, rappresentata da un punto (), separando le varie componenti con un punto. Per esempio: www.ietf.org & il nome di dominio dell\u0019host che offre il servizio web per l'organizzazione IETF (Internet Engineering Task Force). Infatti www è il nome del server web che si trova nel dominio ietf che a sua volta & contenuto nel dominio org il quale discende dal dominio radice. Da notare che per il DNS i nomi \u001cwww.ietf.org\u001d e \u001cwww.ietf.org.\u001d sono uguali in quan- to il punto finale (che indica il dominio radice) & implicito in ogni nome di dominio, quindi puo essere omesso. Valgono poi le seguenti regole: * i nomi delle singole componenti del cammino completo non devono superare i 63 caratteri, inclusi i punti (sono preferibili i nomi facili da ricordare); La gestione dei nomi di domi- nio di primo livello è effettua- ta dall'organizzazione IANA (Internet Assigned Numbers Authority). Un elenco aggiornato dei Top Level Domain si trova all'indirizzo: www.iana.org/domains root/db/. IANA collabora con ICANN (Internet Corporation for As- signed Names and Numbers) I'ente che gestisce il DNS a livello mondiale e coordi- na le attivita dei root Name Server. 329 UNITÀ 7 FIGURA 14 Formato delle PDU DNS 330 LA CONFIGURAZIONE DEL DHCP E DEL DNS e un cammino completo non deve superare i 255 caratteri, quindi meglio limitare il numero di livelli usati (non più di 5) e scegliere dei nomi brevi, per non renderne troppo complessa l'amministrazione; e i nomi sono case-unsensitive, quindi è indifferente scrivere .it oppure .IT, perché entrambi individuano lo stesso dominio; * ogni dominio controlla i suoi sottodomini, quindi se si vuole creare un nuovo sot- todominio è necessario il permesso del dominio padre, mentre non si deve chie- dere alcun permesso ai livelli superiori dell'albero. 6.2 Il formato dei pacchetti DNS 1l formato dei pacchetti DNS consente a un client di porre più richieste (query) in un singolo messaggio (DNS request). Ogni query consiste nel nome di dominio del qua- le il client cerca I'indirizzo IP e il tipo di oggetto desiderato (per esempio I'indirizzo). 1l server risponde restituendo un messaggio simile (DNS reply) che contiene le risposte (answer) alle query. Se non pud soddisfare tutte le query, il server indica nel messag- gio di risposta altri Name Server che il client pud contattare per ottenere le risposte. In FiGURA 14 è mostrato il formato delle PDU DNS, dove RR indica il Resource Record. 0 1516 fisg 31 11 pacchetto è formato da una parte di header fissa di 12 byte e da 4 campi a lunghez- za variabile. 1 campi hanno il seguente significato: * identificativo: è deciso dal client e inserito nelle risposte del server, permette di far corrispondere le reply alle request; * flag: è un campo a 16 bit cosi suddiviso: \u0014 QR indica se il messaggio & una query (0) o una risposta (1); - Opcode indica il tipo di request: 0 = Query Standard 1 = Query Inversa 2 = Richiesta di Stato del Server dal 3 al 15 non sono attualmente utilizzati; \u0014 AA se vale 1 indica una risposta authoritative del server; = TC se vale 1 indica che la reply eccedeva i 512 byte e il messaggio è stato troncato; IL DNS (DOMAIN NAME SYSTEM) LEZIONE 6 \u0014 RD se vale 1 indica che si desidera una ricerca ricorsiva, altrimenti la ricerca sarà iterativa, è impostato dal #local resolver; Local resolver - RA Ricorsione Disponibile (Available), impostato dal server; È l'applicazione client che ri- \u0014 Zero deve essere 0, è riservato per usi futuri; siede sull'host e, a fronte di - RCod Codice di ritorno: i npma Testitkscs i0 Yalos re, solitamente un indirizzo IP. 0 = Nessun errore 1 = Errore nella costruzione della query 2 = Errore interno nel server dei nomi 3 = Ricevuto da un server di autorità, indica che il nome specificato nella query non esiste nel dominio 4 = 1l server dei nomi non implementa quel tipo di query 5 = Il server si rifiuta di eseguire l\u0019operazione per motivi di impostazioni Dal 6 al 15 sono riservati per usi futuri; \u0014 i4 campi successivi specificano il numero di occorrenze presenti in ciascuno dei 4 campi che si trovano dopo l\u0019header (query, answer, authority, additional infor- mation). Per esempio, per una query, QDcount è di solito 1 e i contatori degli altri campi sono 0; per una answer, ANcount è almeno 1, mentre gli altri con- tatori possono essere 0 o maggiori; e query section: di solito in questa sezione si trova la domanda; contiene un nume- ro di entry, con nome, tipo e classe della query, pari al valore QDcount specificato; * le 3 sezioni successive sono tutte costituite nello stesso modo: ogni sezione ha un numero variabile di Resource Record. 6.3 | Resource Record (RR) Ogni dominio, o meglio, ogni zona mantiene le informazioni in strutture dette Resource Record (letteralmente: descrittore di risorsa). Luso più frequente di queste strutture è per ottenere un indirizzo IP: dato il nome di un host, il DNS trova il Resource Record che mantiene l'associazione tra quel no- me e 'indirizzo IP. In realtà, questi record, come si vedra in seguito, possono contenere altri dati oltre all'indirizzo IP. FIGURA 15 Tracciato di un Name Type Class s RDLength RData Resource Record La FiGURA 15 mostra il formato di un Resource Record, definito in RFC 1035, in cui: e Name (DN, Domain Name) è il nome del dominio a cui il record appartiene; * Type identifica il tipo di informazione contenuta nel campo RData; e Class indica se le informazioni del record fanno riferimento a Internet o ad altro. La classe Internet & indicata con IN; * TTL (Time To Live) indica la stabilita del record; pit il valore è alto, pit il record & stabile e sara memorizzato nella cache del DNS. Un valore zero indica che il RR non deve essere memorizzato nella cache (per esempio i RR SOA sono sempre di- stribuiti con TTL = 0); * RDLength specifica la lunghezza in ottetti del campo RData; * RData ¢ il valore restituito dal DNS, può contenere un numero, una stringa ASCII o un nome di dominio, dipende da quanto scritto nel campo Type. 331 UNITÀ 7 FIGURA 16 Tracciato di un Resource Record Ì!\\ school pingu di lix 332 dominio school.it LA CONFIGURAZIONE DEL DHCP E DEL DNS Alcuni tipi di Resource Record sono diventati obsoleti, elenchiamo quindi di seguito solo quelli attualmente utilizzati. Per gli esempi riportati in ogni voce dell\u0019elenco, si fa riferimento alla parte di albero evidenziata in FiGURA 16 dove, con nomi del tutto inventati, il Domain Name è una macchina (chiamata pingu) del dipartimento di informatica (di) di una scuola (school) che si trova in Italia (it). Contenuto del campo Type (identifica il tipo di informazione contenuta nel campo RData): * A (Address): indica che nel campo RData si trova l'indirizzo IPv4 dell\u0019host, quindi un numero binario di 32 bit. Per esempio: pingu.di.school.it. A IN 86400 198.45.30.165 indica che I'host con DN = pingu.di.school.it. ha indirizzo IP 198.45.30.165 e que- sta informazione è stabile (TTL = 86.400 secondi è un valore alto). * AAAA: come A ma riferito a indirizzi IPv6; questo tipo è stato introdotto in se- guito nell\u0019RFC 1886. * CNAME (Canonical NAME): indica un nome di dominio e viene tipicamente usa- to per definire degli alias. Per esempio: www.di.school.it. CNAME IN pingu.di.school.it. definisce www.di.school.it. come un alias per I'host il cui nome canonico (cioé standard) è pingu.di.school.it. Quindi se in futuro I'host pingu verra cambiato e il nome di dominio del nuovo web server sara lix.di.school.it., si modifichera I'infor- mazione nel Resource Record, ma non sara necessario cambiare anche I'indirizzo web usato dagli utenti. * MX (Mail eXchange): specifica una lista di server di posta elettronica ai quali in- viare le e-mail destinate a uno specifico nome di dominio; nel campo RData si tro- vera il nome del dominio che accetta la posta per conto del dominio indicato nel campo Name. Per esempio: pingu.di.school.it. MX 1 IN istruzione.it. pingu.di.school.it. MX 2 IN education.it. Supponiamo che I'host pingu non sia inserito in Internet. Non pud quindi ricevere la posta elettronica, e il Resource Record a lui associato indica che le e-mail destinate a pingu devono essere inviate ad altri domini che poi le ritrasmetteranno a pingu secondo gli accordi presi (per esempio via rete mobile). Nell'esempio, la posta viene inviata prima a istruzione.it. (il numero 1 indica la prima scelta) e nel caso questo server non sia in grado di riceverla, deve essere inviata a education.it. (numero 2). * NS (Name Server): è l'authoritative Name Server per il dominio specificato. 1 Name Server usano i Resource Record di tipo NS per trovarsi I'un l'altro. Per esempio: di.school.it. NS IN name1.di.school.it. indica che il dominio di.school.it. ha come Name Server namel.di.school.it. IL DNS (DOMAIN NAME SYSTEM) Si deve avere un NS record per ogni Name Server (primario o secondario) di un dominio. * PTR (PoinTerR): è un puntatore a un\u0018altra parte dello spazio dei nomi, ed è utiliz- zato soprattutto per associare un nome di dominio a un indirizzo IP nel dominio in-addr.arpa per la risoluzione inversa (trattata nelle pagine successive). Ci deve essere un solo PTR record per ciascun indirizzo IP. Per esempio: 165.30.45.198.in-addr.arpa. PTR IN pingu.di.school.it. indica che l\u0019indirizzo IP = 198.45.30.165 appartiene all\u0019host: pingu.di.school.it. * TXT (TeXT): consente di associare un testo a un nome di dominio. Si possono avere più record TXT associati a un singolo Name. Per esempio: pingu.di.school.it. TXT IN \u001cServer Linux del Dipartimento di Informatica\u001d TXT IN \u001cAmministratore: marcot@di.school.it\u001d * SOA (Start Of Authority): fornisce il nome della fonte principale di informa- zioni sulla zona del Name Server. Esso contiene la versione attuale del database DNS, l\u0019indirizzo di posta elettronica dell\u0019amministratore e altri parametri. Questo record deve essere obbligatoriamente presente nel livello più alto del dominio e de- ve essere unico per ogni Name Server (o, meglio, per ogni zona a cui appartiene il Name Server). 6.4 Come funziona il DNS? Lalbero gerarchico del DNS è implementato mediante una base di dati distribuita in cui sono memorizzati i Resource Record. Il fatto che sia distribuita garantisce il funzionamen- to continuo della rete: se tutte le informazioni fossero memorizzate su un unico server e questo si guastasse, si fermerebbe tutta la rete Internet. Non solo, questo server sarebbe così sovraccarico per tutte le richieste da soddisfare da non essere in pratica utilizzabile. Quindi la soluzione è stata di suddividere lo spazio dei nomi del DNS in zone di- sgiunte, ognuna con un Name Server principale (DNS primario) e dei Name Server secondari (DNS secondario) che attingono al principale per avere le informazioni. 1 client che accedono ai Name Server sono i resolver: quando un\u0018applicazione ne- cessita di informazioni dal DNS usa questa libreria per effettuare le interrogazioni (query). Se il Resource Record ¢ authoritative per la zona richiesta, il server DNS ri- spondera direttamente in quanto dispone dell'informazione, mentre in caso contra- rio effettuera una ricerca all'interno dello spazio dei nomi per trovare i dati richiesti. Questo processo si chiama risoluzione dei nomi. Ci sono due tipi di query DNS: * iterative: richiedono a un server DNS la miglior risposta che gia conosce; * ricorsive: chiedono al server DNS di rispondere alla query in modo completo. Di regola i resolver effettuano query ricorsive, lasciando cosi al Name Server il com- pito dirisolvere il nome. I Name Server invece solitamente effettuano query iterative, seguendo via via i rimandi, finché non trovano la risposta. 333 UNITÀ 7 LA CONFIGURAZIONE DEL DHCP E DEL DNS Infatti un Name Server può inviare una query ricorsiva a un altro Name Server, ma spesso questi la rifiuta per evitare di essere sovraccaricato. Quando si verifica questa situazione, l\u0019interrogazione diventa iterativa senza che l'utente finale se ne accorga. esempio FIGURA 17 Interrogazione del DNS Resolver 334 In FiGURA 17 è illustrato il meccanismo di interrogazione del DNS nel caso di un utente che scrive l'indirizzo mnemonico del sito: www.company.com, nella barra degli indirizzi del browser. Root Server Authoritative Name Server company.com 1) Ilcomputer Resolver chiede al Default DNS Server dirisolvere il nome fornito, inviando un messaggio DNS request con il tipo di richiesta (A) e la classe (IN) per ottenere così il corrispondente indirizzo IP, che successivamente sara utilizzato per stabilire la con- nessione con la macchina remota che ospita il web server. Il Default DNS Server solita- mente è il server del provider che fornisce la connessione a Internet, ma potrebbe an- che essere un server DNS interno alla LAN se il computer è connesso a una rete locale. Il suo indirizzo IP si trova nel file di configurazione del protocollo TCP/IP sul com- puter. 2) Il Default DNS Server verifica prima di tutto se possiede l'indirizzo IP corrispon- dente al nome da risolvere. Potrebbe, infatti, essere in grado di risolvere autono- mamente quel nome, perché ha nella cache le informazioni relative oppure perché tale nome è gia stato risolto in precedenza. In caso contrario, esso interroga uno dei root server, dando inizio al processo di ricerca delle informazioni all'interno della gerarchia dei Domain Name. Le interrogazioni DNS request avvengono uti- lizzando un datagram UDP. 3) Il Root Server risponde con I'indicazione del server responsabile per lo spazio dei nomi .com. 4) Cosi il Default DNS Server può inoltrare la stessa richiesta all\u0019authoritative Name Server di .com, il quale non & in grado di risolvere completamente il nome www.company.com, ma conosce il server che lo può fare (ossia il Name Server responsabile per la zona company.com). 5) Il Name Server del dominio .com invia al Default DNS Server |'indirizzo dell\u0018authori- tative Name Server della zona .company.com. IL DNS (DOMAIN NAME SYSTEM) 6) Il Default DNS Server invia la richiesta di risoluzione del nome all'indirizzo appena trovato del Name Server della zona company.com. 7) I Name Server riconosce il nome www come facente parte della zona company.com e restituisce al Default DNS Server l'indirizzo IP corrispondente. 8) Con il messaggio DNS reply del Default DNS Server, il computer ottiene l'indirizzo IP. Una volta ottenuto I'indirizzo IP del web server, il computer può inviargli la richiesta della pagina web con un messaggio di get che verra instradato nella rete e, arrivato a destinazione, verra letto dal server web. Questi rispondera inviando la pagina desi- derata. Alcune considerazioni: e un Name Server intermedio potrebbe anche avere gia soddisfatto una simi- le richiesta e memorizzato nella cache una copia della risposta. In questo ca- so il Name Server fornisce una risposta dichiarandola di tipo non authorita- tive. Questo tipo di risposta non è del tutto affidabile poiché se nel frattempo fossero intervenute delle modifiche, queste non verrebbero propagate agli altri Name Server che quindi manterrebbero nella loro cache il dato precedente, non più corretto. Di qui I'importanza del campo TTL (Time To Live) del Resource Record che sta a indicare la stabilita dell'informazione. Per esempio un hostname con un TTL molto alto indica che quell\u0019host ha lo stesso indirizzo IP da molto tempo e quindi anche se I'informazione non è authoritative ha un'alta probabi- lita di essere corretta; e ogni Name Server che ha autorita su un dominio è duplicato per motivi di affida- bilità; si ha quindi un Name Server primario e un Name Server secondario che devono essere periodicamente sincronizzati cosi da avere le stesse informazioni memorizzate in entrambi. Per effettuare questo allineamento si usa una connes- sione TCP che consente di trasferire in modo affidabile notevoli quantita di dati (invece di usare UDP come nelle interrogazioni). Quindi di norma il Name Server è in ascolto sulla porta 53 TCP e sulla porta 53 UDP. 6.5 La risoluzione inversa Quanto descritto nell'esempio precedente è il tipico processo di risoluzione dei no- mi: dato un nome si deve trovare il corrispondente indirizzo IP. Esiste anche la possibilita di associare a un indirizzo IP il nome corrispondente e questo processo viene chiamato risoluzione inversa. Di risoluzione inversa abbiamo gia scritto a proposito del Resource Record PTR: in- fatti questo tipo di RR è usato per memorizzare l'associazione tra IP address e name, partendo dalla conoscenza dell'indirizzo IP (al contrario, quindi, degli RR di tipo A usati per la risoluzione, più frequente, dei nomi in indirizzi IP). Questa ricerca viene resa semplice dal fatto che è stato creato un apposito dominio in-addr.arpa che usa la rappresentazione numerica degli indirizzi IP come etichet- te dei nodi (cioè come name). Questo speciale dominio pud avere fino a 256 sottodo- mini di terzo livello (numerati da 0 a 255) corrispondenti ai possibili valori del primo 335 UNITÀ 7 FIGURA 18 Risoluzione inversa 336 LA CONFIGURAZIONE DEL DHCP E DEL DNS byte di un indirizzo IP; ognuno di questi a sua volta può avere fino a 256 sottodomini di quarto livello, anch\u0019essi numerati da 0 a 255, che corrispondono ai possibili valori del secondo byte, e così via. Quindi per risolvere un indirizzo IP richiesto, il resolver deve semplicemente chiedere al Name Server il Resource Record di tipo PTR del nodo corrispondente nel dominio in-addr.arpa. Per esempio, per ottenere il nome di dominio associato all\u0019indirizzo IP 198.45.30.165, il resolver richiederà al DNS il Resource Record PTR del nome di do- minio 165.30.45.198.in-addr.arpa (FIGURA 18). 1°numero decimale dell'ind. IP 2°numero decimale dell'ind. IP numero decimale dell'ind. IP 1° numero decimale dell'ind. IP Come si può notare, nel dominio in-addr.arpa gli indirizzi IP sono al contrario, in conseguenza della differente interpretazione della posizione degli elementi negli indirizzi IP e nei nomi di dominio. Infatti gli indirizzi IP diventano più specifici da sinistra verso destra, mentre i nomi di dominio diventano più specifici da destra verso sinistra. Quindi chiamare i nodi del dominio in-addr.arpa in questo modo permette agli indirizzi IP di riflettere correttamente la struttura gerarchica del DNS. FISSA LE CONOSCENZE = Qual è I'ente preposto alla gestione del DNS? m Perché il database del DNS è distribuito? m Descrivi il formato dei messaggi scambiati tra DNS Client e DNS Server. = In quale struttura vengono mantenute le informazioni sui nomi di dominio? - Sia I'RR di tipo A sia I'RR di tipo PTR contengono l'associazione tra un indirizzo IP e un nome; in che cosa, però, differiscono? # Come è da interpretare una risposta di tipo non authoritative? PROBLEMATICHE DI SICUREZZA (i£d PROBLEMATICHE DI SICUREZZA 7.1 La non sicurezza di DHCP e DNS 11 DHCP utilizza i protocolli UDP e IP che sono intrinsecamente insicuri e nelle sue specifiche non si fa riferimento a possibili misure per la sicurezza. Se ai tempi in cui è stato standardizzato questo protocollo il numero di utenti di Internet era limitato e si trattava per lo più di enti accademici e di ricerca, attualmen- te le problematiche di sicurezza sono di centrale importanza, soprattutto per un pro- tocollo come DHCP che tratta informazioni di configurazione. In particolare, ne individuiamo due derivanti da: * DHCP Server non autorizzati: un DHCP Server abusivo potrebbe inserirsi e ri- spondere alle richieste del client fornendo informazioni false in modo da inibire gli host, oppure configurandoli per azioni fraudolente; * DHCP Client non autorizzati: un host potrebbe ottenere le informazioni di con- figurazione destinate a un certo client con lo scopo di creare danni alla rete, oppure potrebbe usare un software che genera moltissime richieste DHCP cosi da esaurire gli indirizzi a disposizione del server e bloccare nuovi accessi alla rete. Un modo per ovviare a questi inconvenienti ¢ introdurre meccanismi di sicurezza nei livelli più bassi, per esempio evitando che un device non autorizzato possa inse- rirsi fisicamente nella rete. Inoltre, si potrebbe usare IPsec per rendere sicuro il livello Network. 11 DNS è particolarmente critico dal punto di vista della sicurezza per vari motivi: * non è autenticato: I'informazione richiesta potrebbe arrivare non dal DNS Server corretto ma da un'altra macchina; © è molto lento, quindi è possibile che qualcuno intercetti la richiesta destinata a un DNS Server e risponda al suo posto (spoofing); « il protocollo non offre meccanismi per proteggere I'integrita delle informazioni distribuite (basti pensare all'associazione tra hostname e indirizzo IP). In passato si sono avuti casi di DNS cache poisoning volti a manomettere le informa- zioni contenute nei DNS Server, compromettendo la coerenza e l\u0019integrità dei suoi dati. Nella precedente Lezione si & visto come un DNS Server mantenga in una memoria cache anche informazioni relative a domini non di sua competenza. Una risposta fornita sulla base di questi dati è detta non authoritative e il valore del campo TTL indica quanto sia attendibile (più è alto il TTL più & alta la probabilita che il dato sia corretto). Un at- tacco di tipo cache poisoning a un DNS Server comporta la modifica dei dati della sua cache, inserendovi un valore di TTL molto alto, cosi da rendere attendibile I'informazione modificata. Tipicamente, I'intervento consiste nell'associare a un nome l'indirizzo IP di un server malevolo. Per esempio, un utente scrive nel browser I'URL di un sito web ma viene poi direzionato, a sua insaputa, verso un sito clone costruito per effettuare furti di identita o di dati bancari. Questo succede perché nella cache del DNS Server l'indirizzo 1P originale, associato a quel nome, è stato sostituito con quello del web server malevolo. LEZIONE 7 IP security protocol (IPsec) protegge i pacchetti IP scam- biati tra host e router a livel- lo Network, garantendone la confidenzialita. Inoltre, offre i servizi di au- tenticazione del mittente e diintegrita dei dati. IN EN H PL DNS cache poisoning (or DNS spoofing) is a form of computer security hacking in which corrupt DNS data is introduced into the DNS resolver's cache, causing the Name Server to return an incorrect IP address. This results in traffic being diverted to another computer. 337 UNITÀ 7 DHCP Server ® Processo DHCP: al client sono assegnate le informazioni di configurazione î TCPAP DHCP Client © Aggiornamento s dinamico del DNS: DNS il client crea Server un nuovo record A FIGURA 19 Processo di aggiornamento dinamico del record A di un client Windows In alcuni ambiti di rete che ri- chiedono un livello di sicurez- za molto elevato pud non es- sere sufficiente l'autenticazio- ne del DNS Client per creare o modificare un record DNS. In questi casi una soluzione è la definizione di Access Control List (che verranno trattate nel corso del quinto anno) per definire i permessi degli utenti. 338 LA CONFIGURAZIONE DEL DHCP E DEL DNS Per rimediare alle mancanze del protocollo originario in termini di sicurezza, in am- bito IETF è stato creato un gruppo di lavoro che ha definito un'estensione al DNS de- nominata DNSSEC (Domain Name System Security Extensions). 1l compito di DNSSEC è di garantire all'utente che il sito web che sta visitando & quello ori- ginale e non una copia creata per scopi fraudolenti. A tal scopo si usano delle chiavi critto- grafiche per autenticare i dati nel DNS, a partire dalla root. Le chiavi per la root sono gestite da ICANN, I'ente responsabile dei Domain Name di primo livello (generici e nazionali). Proprio per il ruolo particolarmente critico che il DNS riveste nell\u0018attuale scenario di Internet, 'ICANN ha evidenziato la necessita di stabilire metriche e modalita per il controllo del DNS, individuando 5 indicatori importanti: coerenza, integrita, velo- cita, disponibilita e robustezza. 7.2 La protezione dei client nelle reti Microsoft In una rete interna Microsoft, un client puo ottenere indirizzi IP differenti ogni volta che viene acceso, poiché utilizza il protocollo di configurazione dinamica DHCP. Di conseguenza la configurazione dei Resource Record DNS è automatica. Tipicamente i PC con versioni recenti di Windows sono in grado di gestire I'aggiorna- mento dinamico del record DNS: quando ottengono un indirizzo IP dal DHCP Server, inviano la richiesta di aggiornamento del record A relativo al client. La FiGURA 19 descrive le due fasi di aggiornamento dinamico del record DNS: 1. quando il computer viene acceso, lo scambio di messaggi con il DHCP Server for- nisce indirizzo IP e altre informazioni di configurazione di TCP/IP (default gateway e indirizzo del DNS Server); 2.l client comunica con il DNS Server per creare un nuovo record A relativo all\u0019hostname del computer e al suo indirizzo IP. Quando il client tenta di registrare un record A e scopre che ne esiste gia uno con lo stesso nome, ma indirizzo IP diverso, per default tenta di sostituirlo con quello nuo- vo. In questo modo, perd, un qualunque computer della rete potrebbe modificare un record A sul DNS Server. 1l processo appena descritto pud essere reso sicuro con due diversi procedimenti: au- tenticazione del client oppure assegnazione dei permessi in base alle zone DNS. Le zone che sono configurate per aggiornamenti dinamici sicuri permettono solo ai client autorizzati di modificare i Resource Record. Di norma, sono gestiti nel seguente modo: dapprima il DNS Client cerca di usare la modalità dinamica non sicura e se viene rifiutata dal server passa allora a usare la modalita sicura. Quando poi una zona ¢ integrata in Active Directory, il DNS Server (configurato su Windows Server) per default consente solo aggiornamenti dinamici sicuri. La configurazione degli aggiornamenti dinamici sicuri richiede quindi I'impo- stazione di alcuni parametri sul DNS Server. In particolare, Microsoft raccomanda che esso venga installato su un Domain Controller e che le zone siano integrate in Active Directory (servizi che affronteremo nel quinto anno). FISSA LE CONOSCENZE m Descrivicome DHCP Server non autorizzati e DHCP Client non autorizzati pos- sono creare problemi di funzionamento della rete. m Spiega in che cosa consiste il DNS cache poisoning. = Come può essere reso sicuro l'aggiornamento del DNS? LABORATORIO PACKET TRACER: LA CONFIGURAZIONE DEGLI HOST 9.1 Configurazione automatica degli host tramite un router DHCP In questa esercitazione di laboratorio realizzeremo con il simulatore Packet Tracer quanto appreso sul DHCP. + PROBLEMA Realizzare due reti LAN configurando il servizio DHCP sul router per assegnare auto- maticamente gli indirizzi IP, la subnet mask e il gateway a tutti gli host delle due LAN. File sorgenti Scarica il file + ANALISI DEL PROBLEMA Il servizio DHCP può essere configurato sul router o su un server. Poiché il router ha anche molti altri compiti e di conseguenza molte elaborazioni da eseguire, è consiglia- bile affidargli il servizio DHCP solo in presenza di LAN di ridotte dimensioni e fornirsi invece di una macchina server in presenza di LAN con centinaia di host. Lindirizzo IP del router fungera da gateway per la rete e verra inviato insieme all'IP e alla subnet mask. Per impostare gli address pool delle due reti useremo la CLI (Command Line Interface) del router. è SVOLGIMENTO Nella FiGura 21 è mostrato un possibile scenario con due LAN collegate da un router. FIGURA 21 Scenario router DHCP su due LAN Tile Tde Opbions View Tools Cxtensions llelp PEFY QAQAAO0T B =E LAC ALT LABORATORIO Le interfacce del router di default sono OFF. Vanno messe ON. FIGURA 22 Configurazione di rete assegnata automaticamente al PC1 Se il servizio DHCP non & con- figurato, interverrà l'APIPA (se gli host sono Windows) ad assegnare gli indirizzi IP nell'intervallo 169.254.1.0 - 169.254.254.255. La subnet mask verra automaticamen- te impostata su 255.255.0.0 e I'indirizzo del gateway su 00.00. Per le due reti locali utilizziamo i soliti indirizzi privati 192.168.1.0 e 192.168.2.0. Dopo aver piazzato i dispositivi e averli collegati tra loro, configuriamo manualmente il router assegnando alle sue interfacce GigabitEthernet gli IP 192.168.1.254 per la LAN1 e 192.168.2.254 per la LAN2, entrambe con subnet mask 255.255.255.0. Questi due indirizzi delle porte del router saranno i gateway per gli host delle due LAN. Tutti gli altri indirizzi li assegnera il router automaticamente col servizio DHCP. Apriamo la CLI del router e scriviamo i comandi per la configurazione della LAN1: Router(config)#ip dhcp pool LAN1 Router(dhcp-config)#network 192.168.1.0 255.255.255.0 Router(dhcp-config)#default-router 192.168.1.254 Allo stesso modo configuriamo con i seguenti comandi la LAN2: Router(config)#ip dhcp pool LAN2 Router(dhcp-config)#network 192.168.2.0 255.255.255.0 Router(dhcp-config)#default-router 192.168.2.254 La prima istruzione dà un nome al pool di indirizzi della rete in questione, la secon- da imposta I'indirizzo generico e la subnet mask di quella rete e la terza imposta il gateway. A questo punto non resta che controllare se gli indirizzi sugli host sono stati assegnati aprendo le schede IP Configuration di ogni PC. Nella FiGura 22 si possono vedere i valori di IPv4, Subnet Mask e Default Gateway as- segnati dal router-DHCP al PC1. L el - e X .\u0014m CU: Clìlu\u0019i Pregammirg Attibutes a edaca Fas:Ethemer0 v P Confguration @ once C Static Pt Address 182 16014 Subnet Nack 266 266 266 0 Detauit Gaomay 182 1681254 DHS Serer 3000 16 Confguiation O Automatic @ Static PA Address [ ]\u0018[ ] link | ocal Address [FF80-20) 48FF FEFS ATCD ] Vetaut Careay L ] DNS Serrer [ ] E 1% ] Use 802 1% Sacsrity | aumeriesion __ ia ] O re A volte è necessario escludere qualche indirizzo IP dal pool di indirizzi affidato al router DHCP perché si vuole utilizzarli come indirizzi statici su host particolari (ser- ver, stampanti di rete, ecc.). In tali casi si può, sempre dalla CLI del router, dare il comando: Router(dhcp-config)#ip dhcp excluded-address 192.168.1.2 Quando il router DHCP ha terminato |'assegnazione di tutti i parametri a tutti gli host, & possibile testare il corretto funzionamento delle due reti con un ping (simple PDU) tra un host della LAN1 e un host della LAN2. 9.2 Configurazione automatica degli host tramite un server DHCP GG 0 | + PROBLEMA Realizzare una rete LAN configurando il servizio DHCP su un server per assegnare automaticamente gli indirizzi IP, la subnet mask e il gateway a tutti gli host della LAN. ?!:ri\u0018:?l.\u0001'i\u0018;' > ANALISI DEL PROBLEMA Lutilizzo di una macchina server posizionata in ogni LAN rende più efficiente il servizio. Le macchine con compiti particolari (router e server) & meglio abbiano un IP scelto dall\u0019amministratore di rete, quindi non casuale. - SVOLGIMENTO Nella FiGuRra 23 & mostrato un possibile scenario LAN con un server DHCP. 0 Cisco Packet Traces - C\\Usersirsron Deskiop\\ EDIZIONE INES T\\ 2 FIGURA 23 Scenario server Fie Ecr Opions View ookt Extarsicns Hola DHCP in una LAN AERPOLL @F I AADE 1 #a ? Assegniamo manualmente al router e al server rispettivamente gli IP statici 192.168.1.254 e 192.168.1.100. Dopo aver piazzato gli host e averli collegati in rete, configuriamo il 343 P LABORATORIO \\ ! = ) ZIONE ) servizio DHCP sul server. Apriamo la scheda Services del server (FIGURA 24), selezioniamo DHCP e compiliamo i campi: m = Pool Name m Start IP Address = Maximum Number of lIservizio DHCPsul server,di @ Default Gateway = Subnet Mask User default è OFF. Va messo ON. Il Default Gateway sara, come nell\u0019esercizio precedente, l'IP del router 192.168.1.254. Qualunque altro host aggiunto allo scenario ricevera automaticamente i parametri di configurazione impostati sul server. FIGURA 24 Configurazione B s DHC = a3 X el smiveiio DHOP' Ul sV Sy Cody _Suic Dwecy Prigommes A vy |- _MT | bl [Pt w0 : a Podi Namre (14 Detak Gy s Sesoc oo A St 19 Adwreac : FSE l L P 13 =3 M e o Users _ - e T | toduorar | I \" ra d DNE e Saw a aF o H Ddvwsr Swm L e Sem Adben rPo 280160125 0300 182°68 15 2552662610 NS 0070 OE00 Nella FiGura 25 si possono vedere i valori di IPv4, Subnet Mask e Default Gateway assegnati dal server DHCP al PC1, esattamente come aveva fatto il router nell'esercizio precedente (Figura 22). FIGURA 25 Configurazione ® a = u x di rete assegnata automaticamente al PC1 Physical Conhg _Lescdos Programmng Atibutes O amemare @ sar | FISSA LE CONOSCENZE m Come si fa a escludere qualche indirizzo IP dal pool di indirizzi? = Quale scheda del server si usa per configurare il DHCP? m Che differenza c'é tra impostare il DHCP sul router o sul server? = Qual è l'indirizzo del gateway che va impostato per tutta la rete? LABORATORIO @ PACKET TRACER: LA CONFIGURAZIONE DEL SERVER DNS In questa esercitazione di laboratorio realizzeremo con il simulatore Packet Tracer quanto appreso sul DNS. ? PROBLEMA Realizzare due reti LAN aventi ciascuna una home page accessibile dall'esterno median- te un server DNS pubblico in grado di risolvere i nomi delle pagine. Quindi verificarne il funzionamento chiamando, dal web browser di un qualsiasi PC di una delle due reti, la pagina web dell\u0018altra rete. File sorgenti Scarica il file > ANALISI DEL PROBLEMA Per poter risolvere i nomi delle due pagine web e trovare I'indirizzo IP del server su cui sono rispettivamente depositate, occorre configurare il servizio DNS su un server di- chiarando due Resource Records di tipo A Record che abbinino il nome di ogni pagina web al corrispondente IP. + SVOLGIMENTO Nella FIGURA 26 è mostrato un possibile scenario con due LAN e un server DNS pub- FIGURA 26 Scenario con blico. server DNS pubblico Fie E Dpons Ve Tl Evemes W bE0£ i R@F I aaanzE B=sa \u001d > LABORATORIO FIGURA 27 Configurazione del RIP sui 3 router Per le due reti locali utilizziamo i soliti indirizzi privati 192.168.1.0 e 192.168.2.0 mentre per il DNS pubblico usiamo I'indirizzo 40.0.0.1. Per le 3 reti costituite dalle coppie di router usiamo gli indirizzi 10.0.0.0, 20.0.0.0 e 30.0.0.0, assegnando manualmente gli indirizzi alle porte Serial2/0 e Serial3/0 di ogni router. Sempre manualmente assegniamo alle interfacce FastEthernet0/0 dei router delle due LAN gli IP 192.168.1.254 per la LAN1 e 192.168.2.254 per la LAN2, entrambe con subnet mask 255.255.255.0. Tali indirizzi saranno i gateway per gli host delle due LAN. Sui 3 router configuriamo poi il RIP dalla scheda Config (FiGura 27). nn Riv - r it - nx aa w a e u a e ..,... g G A 0 B _ re s - e \u0014 a M \u0014 \u0014 \u0014 - [N S [ 3 aa w1 e Incoa = r el o == T g [ == Fatet 1 s y 1| l ] ] g B z FIGURA 28 Servizio HTTP sul Server1 In ogni LAN avremo poi un server DHCP per assegnare automaticamente gli indirizzi IP agli host della rete. | due server DHCP avranno indirizzo rispettivamente 192.168.1.254 e 192.168.2.254. Aprendo la scheda Services sui server si può notare come il servizio HTTP (Web Server) sia preconfigurato, gia messo di default a ON e con 5 pagine html precaricate (FIGURA 28). B servert - a x Physical Conig _Senices Deskiop Programming Attrbutes A HTTP HTTP HTIPS @ on Oor @®on O o File Manage\u0019 File Name Edt Delets 1 copyrights. htmi (odt) delete) 2 cscoptiogo?77xM.. delete) 3 hellowortd htmi (edt) Idelete) 4 image htmi (edt) delete) v [ MewFie || impon | D Top Cominciamo dal Server1. Selezioniamo il file index.html e clicchiamo sul suo edit. Modifichiamo la pagina web di default che si apre (FiGURA 29) sostituendo il tag <hr> con Welcome to www.aaa.it (FIGURA 30) e salvando la modifica con Save. FIGURA 29 Pagina web \u0018 Serverì - ] X ® di default del Server! Physical Config _ Sences Desktop Programming Attibutes SERVICES | \u001d | File Name [index ttmi ] HITP DHCP <htmi> <center><lont size=\"+2 color=blus>Cisco Packet Tracer<font></ OHCPVE | | |cemer L L t Co M __ _ | | |<pQuick Links <br><a hrot=copynghts himP>Copyrghte</a> <br><a href=image htmi>Image page</a> <br><a href=cscoptiogo177x111 jpg>image</a> </htmi> FIGURA 30 Pagina web i ~ O % modificata del Server1 Physical Config _Senvces Desktop Programming Attributes \" | File Nama: [index temi ] SERVICES HTTP. DHCP. SN <rantac><font sizaz'+7 color=hl w>Cisen Packet Tracarchont></ DHCPVE Pov TFTP DNS SsYsLOG AAA <p>Cuick Links: <br><a href=helloworid himf>A small page</a> <br<a vneewyn htmi\">Copynghts </a> <br><a href='image html>image page</a> <br><a n#e&\\nxm Ipg>image</a> </html> v (FileManager | Sme | Lo stesso va fatto sul Server2 sostituendo il tag <hr> con Welcome to www.bbb.it e salvando la modifica con Save. 347 A questo punto è tutto pronto per la configurazione del server DNS. Apriamo la sche- È possibile caricare qualun- da Services del Server3 e aggiungiamo 2 entry di Name www.aaa.it e www.bbb.it, di que pagina html al posto di Type A Record e con indirizzo IP rispettivamente del Server1 e del Server2 (FIGURA 31). quella di default. Cliccare poi su ADD per aggiungere ogni entry. Non resta che mettere ON il servizio e provarne il funzionamento. Clicchiamo per esempio sul PC8 della rete 192.168.2.0, apriamo la scheda Desktop e selezioniamo il suo Web Browser (FIGURA 32). FIGURA 31 Configurazione del | Server3 = (3] b server DNS 192168 1100 192 168 2 100 FIGURA 32 Scheda Desktop di PC8 Nella scheda Desktop che si apre chiamiamo la pagina web dell'altra rete (192.168.1.0) scrivendo www.aaa.it nella barra dell'URL (ricura 23) e cliccando su Go. x FIGURA 33 Web Browser il = H del PCB L e Co D top FIGURA 34 Apertura della Questo provochera l'interrogazione del server DNS e il risultato sarà l'apertura della home page di www.aaa.it pagina web richiesta (FIGURA 34). richiesta da PC8 u0 L è G d PI AAT DM IwE è EEE ERC & Essendo HTTP un protocollo affidabile, usera TCP come protocollo di trasporto come si può vedere dai pacchetti elencati nella Event List del Simulation Panel. Testare il completo funzionamento del DNS chiamando la pagina www.bbb.it da un qualsiasi PC della rete 192.168.1.0. FISSA LE CONO ENZE = Come si configura il servizio DNS affinché possa risolvere i nomi di una rete? = Come si pud verificare se il DNS è stato correttamente configurato? 349","libVersion":"0.2.3","langs":""}